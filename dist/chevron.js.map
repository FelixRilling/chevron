{"version":3,"sources":["chevron.js"],"names":[],"mappings":"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","file":"chevron.js","sourcesContent":["var Chevron = (function () {\n    'use strict';\n\n    const _more = \": \";\n    const _factory = \"factory\";\n    const _service = \"service\";\n    const _error = _more + \"error in \";\n    const _isUndefined = \" is undefined\";\n\n    /**\n     * Checks if service exist, else add it\n     * @param String name to register/id the service\n     * @param Array list of dependencies\n     * @param String type of service (service/factory)\n     * @param Function content of the service\n     * @return Chevron instance\n     */\n    function provider (type, name, deps, fn) {\n        let _this = this;\n\n        if (_this.chev[name]) {\n            //throw error if a service with this name already exists\n            throw _this.id + _error + type + _more + _service + \" '\" + name + \"' already defined\";\n        } else {\n            //Add the service to container\n            _this.chev[name] = {\n                type,\n                name,\n                deps,\n                fn,\n                init: false\n            };\n\n            return _this;\n        }\n    }\n\n    /**\n     * Adds a new service type\n     * @param String name of the type\n     * @param fn to call when the service is constructed\n     * @return Chevron instance\n     */\n    function extend (type, fn) {\n        let _this = this;\n\n        _this.tl[type] = fn;\n        _this[type] = function (name, deps, fn) {\n            return _this.provider(type, name, deps, fn);\n        }\n\n        return _this;\n    }\n\n    /**\r\n     * Misc Utility functions\r\n     */\r\n    let _each = function(arr, fn) {\r\n        for (let i = 0, l = arr.length; i < l; i++) {\r\n            fn(arr[i], i);\r\n        }\r\n    };\r\n    /**\r\n     * Iterate fn over object\r\n     * @private\r\n     * @param Object values\r\n     * @param Function iterate fn\r\n     * @return void\r\n     */\r\n    /*_eachObject = function (object, fn) {\r\n            let keys = Object.keys(object);\r\n\r\n            _each(keys, (key, i) => {\r\n                fn(object[key], key, i);\r\n            });\r\n    };*/\n\n    /**\r\n     * Collects dependencies and initializes service\r\n     * @private\r\n     * @param Object context\r\n     * @param Object service to check\r\n     * @param Object list of dependencies\r\n     * @return Object service\r\n     */\r\n    function initialize(_this, service, list) {\r\n        let bundle = [];\r\n\r\n        if (!service.init) {\r\n            _each(service.deps, item => {\r\n                let dep = list[item];\r\n\r\n                if (dep) {\r\n                    bundle.push(dep);\r\n                }\r\n            });\r\n\r\n            bundle = bundle.map(item => {\r\n                return item.fn;\r\n            });\r\n\r\n            //Init service\r\n            service = _this.tl[service.type](service, bundle);\r\n            service.init = true;\r\n        }\r\n\r\n        return service;\r\n    }\n\n    /**\n     * Loops/recurses over list of dependencies\n     * @private\n     * @param Object context\n     * @param Array dependencyList to iterate\n     * @param Function to run over each dependency\n     * @param Function to call on error\n     * @return void\n     */\n    //Loops trough dependencies, recurse if new dependencies has dependencies itself; then execute fn.\n    function r(_this, dependencyList, fn, error) {\n        _each(dependencyList, name => {\n            let service = _this.chev[name];\n\n            if (service) {\n                //recurse if service has dependencies too\n                if (service.deps.length > 0) {\n                    //recurse\n                    r(_this, service.deps, fn, error);\n                }\n                //run fn\n                fn(service);\n            } else {\n                //if not found error with name\n                error(name);\n            }\n        });\n    }\n\n    /**\n     * Check if every dependency is available\n     * @private\n     * @param Object context\n     * @param Object service to check\n     * @return bound service\n     */\n    function prepare (_this, service) {\n        let list = {};\n\n        //Recurse trough service deps\n        r(\n            _this,\n            service.deps,\n            //run this over every dependency to add it to the dependencyList\n            dependency => {\n                //make sure if dependency is initialized, then add\n                list[dependency.name] = initialize(_this, dependency, list);\n            },\n            //error if dependency is missing\n            name => {\n                throw _this.id + _error + service.name + _more + \"dependency \" + name + _isUndefined;\n            }\n        );\n\n        return initialize(_this, service, list);\n    }\n\n    /**\n     * Access service with dependencies bound\n     * @param String name of the service\n     * @return Function with dependencies bound\n     */\n    function access (name) {\n        let _this = this,\n            accessedService = _this.chev[name];\n\n        //Check if accessed service is registered\n        if (accessedService) {\n            //Call prepare with bound context\n            return prepare(_this, accessedService).fn;\n        } else {\n            //throw error if service does not exist\n            throw _this.id + _error + name + _more + name + _isUndefined;\n        }\n    }\n\n    /**\n     * Creates typeList entry for service\n     * @private\n     * @param Object context\n     * @return void\n     */\n    function initService (_this) {\n\n        _this.extend(_service, function (service, bundle) {\n            //Construct service\n            let serviceFn = service.fn;\n\n            service.fn = function () {\n                //Chevron service function wrapper\n                return serviceFn.apply(null, bundle.concat(Array.from(arguments)));\n            };\n\n            return service;\n        });\n    }\n\n    /**\n     * Creates typeList entry for factory\n     * @private\n     * @param Object context\n     * @return void\n     */\n    function initFactory (_this) {\n        _this.extend(_factory, function (service, bundle) {\n            //Construct factory\n            //first value gets ignored by calling new like this, so we need to fill it\n            bundle.unshift(null);\n            //Apply into new constructor by accessing bind proto. from: http://stackoverflow.com/questions/1606797/use-of-apply-with-new-operator-is-this-possible\n            service.fn = new(Function.prototype.bind.apply(service.fn, bundle));\n\n            return service;\n        });\n    }\n\n    /**\n     * Basic Chevron Constructor\n     * @constructor\n     * @param String to id the container\n     */\n    let Chevron = function (id) {\n        let _this = this;\n\n        _this.id = id || \"cv\";\n        _this.chev = {};\n        _this.tl = {};\n\n        initService(_this);\n        initFactory(_this);\n    };\n\n    /**\n     * Expose Chevron methods\n     */\n    Chevron.prototype = {\n        //Core service/factory method\n        provider,\n        //Prepare/init services/factory with deps injected\n        access,\n        //Add new service type\n        extend\n    };\n\n    return Chevron;\n\n}());"]}