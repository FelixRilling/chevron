{"version":3,"sources":["chevron.js"],"names":[],"mappings":"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","file":"chevron.js","sourcesContent":["var Chevron = (function () {\n    'use strict';\n\n    //add new service/fn\n    function add (_name, _deps, _type, _fn, _args) {\n        //External applications should not try to access container props as the keys change between min/normal version; stick to cv.access()\n        this.chev[_name] = {\n            _name,\n            _type,\n            _deps,\n            _args: _args || [],\n            _fn,\n            _init: false\n        };\n    }\n\n    const _error = \": error in \";\n    const _factory = \"factory\";\n    const _service = \"service\";\n    const _isUndefined=\" is undefined\";\n\n    //Pushes new service/factory\r\n    function provider(_name, _deps, _type, _fn, _args) {\r\n        let _this = this;\r\n\r\n        if (_this.chev[_name]) {\r\n            throw `${_this.id}${_error}${_type}: ${_service} '${_name}' is already defined`;\r\n        } else {\r\n            add.apply(_this, arguments);\r\n\r\n            return _this;\r\n        }\r\n    }\n\n    //Create new service\n    function service (_name, _deps, _fn) {\n        return this.provider(\n            _name,\n            _deps,\n            _service,\n            _fn\n        );\n    }\n\n    //Create new factory\n    function factory (_name, _deps, _Constructor, _args) {\n        return this.provider(\n            _name,\n            _deps,\n            _factory,\n            _Constructor,\n            _args\n        );\n    }\n\n    //Utility functions\n    var util = {\n        _each: function (arr, fn) {\n            for (let i = 0, l = arr.length; i < l; i++) {\n                fn(arr[i], i);\n            }\n        },\n        _eachObject: function (object, fn) {\n            let keys = Object.keys(object);\n\n            this._each(keys, (key, i) => {\n                fn(object[key], key, i);\n            });\n        }\n    };\n\n    //Initialized service and sets init to true\n    function initialize (service, bundle) {\n        if (service._type === _service) {\n            //Construct service\n            let serviceFn = service._fn;\n\n            service._fn = function () {\n                //Chevron service function wrapper\n                return serviceFn.apply(null,\n                    Array.from(bundle.concat(Array.from(arguments)))\n                );\n            };\n        } else {\n            //Construct factory\n            bundle = bundle.concat(service._args);\n            bundle.unshift(null);\n            //Apply into new constructor by accessing bind proto. from: http://stackoverflow.com/questions/1606797/use-of-apply-with-new-operator-is-this-possible\n            service._fn = new(Function.prototype.bind.apply(service._fn, bundle));\n        }\n\n        service._init = true;\n        return service;\n    }\n\n    //collect dependencies from string, and initialize them if needed\n    function bundle (service, list) {\n        let bundle = [];\r\n\r\n        util._eachObject(list, (item, key) => {\r\n            if (service._deps.includes(key)) {\n                bundle.push(item);\n            }\n        });\n\n        if (!service._init) {\n            return initialize(service, Array.from(bundle));\n        } else {\n            return service;\n        }\n    }\n\n    //Loops trough dependencies, recurse if new dependencies has dependencies itself; then execute fn.\n    function r(container, dependencyList, fn, error) {\n        util._each(dependencyList, name => {\n            let service = container[name];\n            if (service) {\n\n                if (service._deps.length > 0) {\n                    //recurse\n                    r(container, service._deps, fn, error);\n                }\n                fn(service);\n            } else {\n                error(name);\n            }\n        });\n    }\n\n    //Main access function; makes sure that every service need is available\n    function prepare (service) {\n        let _this = this,\n            list = {};\n\n        r(\n            _this.chev,\n            service._deps,\n            dependency => {\n                list[dependency._name] = bundle(dependency, list)._fn;\n            },\n            name => {\n                throw `${_this.id}${_error}${service._name}: dependency '${name}'${_isUndefined}`;\n            }\n        );\n\n        return bundle(service, list);\n    }\n\n    //Returns prepared service\r\n    function access(name) {\r\n        let _this = this,\r\n            accessedService = _this.chev[name];\r\n\r\n        //Check if accessed service is registered\r\n        if (accessedService) {\r\n            return prepare.call(_this, accessedService)._fn;\r\n        } else {\r\n            throw `${_this.id}${_error}${name}: '${name}'${_isUndefined}`;\r\n        }\r\n    }\n\n    let Container = function (id) {\n        let _this = this;\n\n        _this.id = id || \"cv\";\n        _this.chev = {};\n    };\n\n    Container.prototype = {\n        //Core service/factory method\n        provider,\n        //create new service\n        service,\n        //create new factory\n        factory,\n        //prepare/iialize services/factory with deps injected\n        access\n    };\n\n    return Container;\n\n}());"]}